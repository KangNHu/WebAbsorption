package com.liveeasy.web.absorption.core.schehule;import com.alibaba.fastjson.JSON;import org.springframework.data.redis.core.RedisTemplate;import redis.clients.jedis.Jedis;import redis.clients.jedis.JedisPool;import us.codecraft.webmagic.ResultItems;import us.codecraft.webmagic.selector.Json;public class RedisDataResultItemsSchedule extends AbstractDataResultItemsSchedule implements DuplicateRemover<ResultItems> {    private static final String  RESULT_ITEMS = "result_items_";    private static final String  SET_RESULT_ITEMS = "set_result_items_";    private RedisTemplate<String , String> redisTemplate;    public RedisDataResultItemsSchedule(RedisTemplate redisTemplate){        super();        this.redisTemplate = redisTemplate;    }    public RedisTemplate getRedisTemplate() {        return redisTemplate;    }    @Override    protected ResultItems getResultItems() {        ResultItems resultItems = null;            String json = redisTemplate.opsForList().leftPop(getResultItemsKey());            if(null != json) {                resultItems = JSON.parseObject(json, ResultItems.class);                resultItems = !isDuplicate(resultItems) ? resultItems : null;            }        return resultItems;    }    @Override    public void addElement(ResultItems element) {        redisTemplate.opsForList().leftPush(getResultItemsKey() , JSON.toJSONString(element));    }    @Override    public void redoQueue(ResultItems element) {        redisTemplate.opsForSet().remove(getSetResultItemsKey() , JSON.toJSONString(element.getAll()));        redisTemplate.opsForList().rightPush(getResultItemsKey() , JSON.toJSONString(element));    }    @Override    public boolean isDuplicate(ResultItems resultItems) {            return redisTemplate.opsForSet().add(getSetResultItemsKey() , JSON.toJSONString(resultItems.getAll())) == 0;    }    @Override    public void resetDuplicateCheck() {            redisTemplate.delete(getSetResultItemsKey());    }    public String getSetResultItemsKey(){        return SET_RESULT_ITEMS + task.getUUID();    }    public String getResultItemsKey(){        return RESULT_ITEMS + task.getUUID();    }}