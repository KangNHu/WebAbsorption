package com.liveeasy.web.absorption.core.plugin;import us.codecraft.webmagic.*;import us.codecraft.webmagic.downloader.HttpClientDownloader;public class DynamicUserAgentHttpClientDownloader extends HttpClientDownloader{    private UserAgent userAgent;    public DynamicUserAgentHttpClientDownloader(){        super();    }    public void setUserAgent(UserAgent userAgent){        this.userAgent = userAgent;    }    private Spider spider;    @Override    public Page download(Request request, Task task) {        if(spider == null){            spider = (Spider) task;        }        addAgent(task.getSite());        Page page = super.download(request, task);        return page;    }    protected Site addAgent(Site site){        String userAgentRandom = userAgent.getRandom();        if(null != userAgentRandom){            site.setUserAgent(userAgentRandom);        }        return site;    }    @Override    protected void onError(Request request) {        String url = request.getUrl();        super.onError(request);    }    private String getSetKey(){        return "set_"+spider.getUUID();    }    private String getQueueKey(){        return "queue_"+spider.getUUID();    }}