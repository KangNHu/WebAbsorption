package com.liveeasy.web.absorption.core.plugin;import com.liveeasy.web.absorption.core.factory.Product;import us.codecraft.webmagic.*;import us.codecraft.webmagic.downloader.HttpClientDownloader;public class CentralDownloaderPlugin extends HttpClientDownloader implements Product{    private static UserAgent userAgent = UserAgent.newInstance();    private DownloaderPlugin downloaderPlugin;    private Spider spider;    public CentralDownloaderPlugin(){        super();    }    public CentralDownloaderPlugin setDownloaderPlugin(DownloaderPlugin downloaderPlugin){        this.downloaderPlugin = downloaderPlugin;        return this;    }    @Override    public Page download(Request request, Task task) {        synchronized (this) {            if (spider == null) {                spider = (Spider) task;            }        }        if(null != downloaderPlugin){            downloaderPlugin.downloadPreposition(task.getSite() , userAgent.getAgents());        }        Page page = super.download(request, task);        return page;    }    @Override    protected void onError(Request request) {        if(null != downloaderPlugin){            downloaderPlugin.downloadError(request , spider);        }        super.onError(request);    }    @Override    public Product createClone() throws CloneNotSupportedException {        return (Product) super.clone();    }}